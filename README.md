# Secret Santa Telegram Bot

Асинхронный Telegram-бот для розыгрыша "Тайного Санты" с поддержкой MySQL, FSM-регистрацией и административным управлением.

## Возможности
- Регистрация участников с последовательным вводом ФИО, адреса доставки и пожеланий.
- Сохранение данных пользователя (telegram id, username, имя, фамилия, ФИО, адрес, пожелания, отметка администратора) в MySQL через SQLAlchemy.
- Админ-команды: просмотр списка участников, запуск и перезапуск жеребьевки, просмотр пар.
- Алгоритм беспорядка без самодарения; после жеребьевки участникам автоматически приходят данные их получателя.
- Хранение конфигурации в переменных окружения и готовность к запуску в Docker.

## Быстрый старт (Docker)
1. Скопируйте шаблон окружения: `cp .env.example .env` и заполните значения (`BOT_TOKEN`, `ADMIN_ID`, `ENV_BUDGET`, параметры БД).
2. Запустите сервисы: `docker-compose up --build`.
3. Бот стартует автоматически и подключается к базе `db` из docker-compose.

## Локальный запуск
```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
export $(cat .env | xargs)  # или используйте python-dotenv
python -m bot.main
```

## Основные команды
- `/start` или `/register` — начало регистрации.
- `/budget` — показать бюджет подарка.
- `/admin_menu` — меню администратора (доступно только ADMIN_ID).
- `/list_participants` — список участников.
- `/start_draw` — провести жеребьевку и уведомить участников.
- `/restart_draw` — очистить прошлые пары и запустить жеребьевку повторно.
- `/view_pairs` — вывести текущие пары.

## Структура проекта
- `bot/config.py` — загрузка настроек из окружения.
- `bot/db_manager.py` — модели SQLAlchemy и операции с БД.
- `bot/matching_logic.py` — алгоритм жеребьевки.
- `bot/bot_handlers.py` — обработчики команд и FSM для регистрации.
- `bot/main.py` — точка входа бота.

## Требования к окружению
- Python 3.11+
- MySQL 8+ (поддерживается драйвер `asyncmy`).
- Переменные окружения: `BOT_TOKEN`, `ADMIN_ID`, `ENV_BUDGET`, `DB_HOST`, `DB_USER`, `DB_PASSWORD`, `DB_NAME`.

## Как использовать git из IDE
Если вы работаете в IDE (например, PyCharm или VS Code) и хотите отправить локальные изменения в репозиторий:
1. Убедитесь, что проект открыт как git-репозиторий (в строке состояния IDE должен отображаться текущий бранч).
2. Обновите локальную копию: выполните `git fetch`/`git pull` из панели VCS или встроенного терминала IDE.
3. Просмотрите изменённые файлы через вкладку Version Control, добавьте их в индекс (например, кнопкой *Stage* или `git add`).
4. Создайте коммит с осмысленным сообщением через диалог *Commit* или командой `git commit -m "message"`.
5. Отправьте коммит на удалённый репозиторий кнопкой *Push* или командой `git push` (при первом пуше укажите origin и ветку).
6. Если удалённый репозиторий ещё не настроен, добавьте его: `git remote add origin <URL>` и затем выполните push.

